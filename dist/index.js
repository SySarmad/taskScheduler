"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const readline_1 = require("readline");
class Tree {
    constructor() {
        this.cache = new Map();
        this.scheduled = new Map();
    }
    addTask(name, deps) {
        if (!this.cache.has(name)) {
            this.cache.set(name, this.createNode(name));
        }
        let parent = this.cache.get(name);
        for (let dep of deps) {
            let childName = dep.trim().replace(' ', '');
            let child = this.cache.has(childName) ? this.cache.get(childName) : this.createNode(childName, parent);
            if (child != undefined) {
                this.cache.set(childName, child);
                parent === null || parent === void 0 ? void 0 : parent.children.push(child);
            }
        }
    }
    compute() {
        for (let key of this.cache.keys()) {
            const node = this.cache.get(key);
            if (node !== undefined) {
                this.helper(node);
            }
        }
        let order = '';
        for (let key of this.scheduled.keys()) {
            order += key + ' ';
        }
        return order;
    }
    correctFormat(str) {
        if (str.includes(':')) {
            let split = str.split(':');
            if (RegExp(/^\p{L}/, 'u').test(split[0])) {
                return true;
            }
            return false;
        }
        return false;
    }
    isEmpty() {
        return (this.cache.size === 0);
    }
    createNode(name, parent = undefined, children = new Array()) {
        return {
            name: name,
            parent: parent,
            children: children
        };
    }
    helper(node) {
        if (this.scheduled.has(node.name)) {
            return;
        }
        if (node.children.length > 0) {
            for (let child of node.children) {
                this.helper(child);
            }
        }
        if (!this.scheduled.has(node.name)) {
            this.scheduled.set(node.name, true);
        }
    }
}
async function main() {
    const rl = (0, readline_1.createInterface)({
        input: process.stdin,
        //output: process.stdout
    });
    let tree = new Tree();
    for await (const line of rl) {
        if (line.trim()[0] === '#' || line.length === 0) {
            if (!tree.isEmpty()) {
                console.log(tree.compute());
                tree = new Tree();
            }
            continue;
        }
        if (!tree.correctFormat(line)) {
            throw new Error(`Line is incorrect format: ${line}`);
        }
        const task = line.trim().split(':');
        tree.addTask(task[0], task[1].length > 0 ? task[1].split(',') : new Array());
    }
    console.log(tree.compute());
}
main().then(() => process.exit(0)).catch(e => {
    console.error(e);
    process.exit(1);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx1Q0FBMEM7QUFRMUMsTUFBTSxJQUFJO0lBSU47UUFGUSxVQUFLLEdBQUcsSUFBSSxHQUFHLEVBQWdCLENBQUE7UUFDL0IsY0FBUyxHQUFHLElBQUksR0FBRyxFQUFtQixDQUFBO0lBQzlCLENBQUM7SUFFakIsT0FBTyxDQUFDLElBQVksRUFBRSxJQUFjO1FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN2QixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFBO1NBQzlDO1FBQ0QsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDakMsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDbEIsSUFBSSxTQUFTLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUE7WUFDM0MsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQTtZQUN0RyxJQUFJLEtBQUssSUFBSSxTQUFTLEVBQUU7Z0JBQ3BCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQTtnQkFDaEMsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDL0I7U0FDSjtJQUNMLENBQUM7SUFFRCxPQUFPO1FBQ0gsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQy9CLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ2hDLElBQUcsSUFBSSxLQUFLLFNBQVMsRUFBQztnQkFDbEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTthQUNwQjtTQUVKO1FBQ0QsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2YsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ25DLEtBQUssSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFBO1NBQ3JCO1FBRUQsT0FBTyxLQUFLLENBQUE7SUFDaEIsQ0FBQztJQUVELGFBQWEsQ0FBQyxHQUFXO1FBQ3JCLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUNuQixJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQzFCLElBQUksTUFBTSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3RDLE9BQU8sSUFBSSxDQUFDO2FBQ2Y7WUFDRCxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUNELE9BQU8sS0FBSyxDQUFBO0lBQ2hCLENBQUM7SUFFRCxPQUFPO1FBQ0gsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFBO0lBQ2xDLENBQUM7SUFFTyxVQUFVLENBQUMsSUFBWSxFQUFFLFNBQTJCLFNBQVMsRUFBRSxXQUFtQixJQUFJLEtBQUssRUFBUTtRQUN2RyxPQUFPO1lBQ0gsSUFBSSxFQUFFLElBQUk7WUFDVixNQUFNLEVBQUUsTUFBTTtZQUNkLFFBQVEsRUFBRSxRQUFRO1NBQ3JCLENBQUE7SUFDTCxDQUFDO0lBRU8sTUFBTSxDQUFDLElBQVU7UUFDckIsSUFBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFBQyxPQUFNO1NBQUM7UUFDMUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFFMUIsS0FBSyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQ3JCO1NBQ0o7UUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7U0FDdEM7SUFDTCxDQUFDO0NBQ0o7QUFFRCxLQUFLLFVBQVUsSUFBSTtJQUVmLE1BQU0sRUFBRSxHQUFHLElBQUEsMEJBQWUsRUFBQztRQUN2QixLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7UUFDcEIsd0JBQXdCO0tBQzNCLENBQUMsQ0FBQztJQUVILElBQUksSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUE7SUFDckIsSUFBSSxLQUFLLEVBQUUsTUFBTSxJQUFJLElBQUksRUFBRSxFQUFFO1FBQ3pCLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUM3QyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFO2dCQUNqQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO2dCQUMzQixJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQTthQUNwQjtZQUNELFNBQVE7U0FDWDtRQUNELElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLElBQUksRUFBRSxDQUFDLENBQUE7U0FDdkQ7UUFDRCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ25DLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssRUFBVSxDQUFDLENBQUE7S0FDdkY7SUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO0FBRS9CLENBQUM7QUFFRCxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtJQUN6QyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2hCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDbkIsQ0FBQyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVJbnRlcmZhY2UgfSBmcm9tICdyZWFkbGluZSdcblxudHlwZSBOb2RlID0ge1xuICAgIG5hbWU6IHN0cmluZyxcbiAgICBwYXJlbnQ6IE5vZGUgfCB1bmRlZmluZWQsXG4gICAgY2hpbGRyZW46IE5vZGVbXVxufVxuXG5jbGFzcyBUcmVlIHtcblxuICAgIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgTm9kZT4oKVxuICAgIHByaXZhdGUgc2NoZWR1bGVkID0gbmV3IE1hcDxzdHJpbmcsIGJvb2xlYW4+KClcbiAgICBjb25zdHJ1Y3RvcigpIHsgfVxuXG4gICAgYWRkVGFzayhuYW1lOiBzdHJpbmcsIGRlcHM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5jYWNoZS5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUuc2V0KG5hbWUsIHRoaXMuY3JlYXRlTm9kZShuYW1lKSlcbiAgICAgICAgfVxuICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5jYWNoZS5nZXQobmFtZSlcbiAgICAgICAgZm9yIChsZXQgZGVwIG9mIGRlcHMpIHtcbiAgICAgICAgICAgIGxldCBjaGlsZE5hbWUgPSBkZXAudHJpbSgpLnJlcGxhY2UoJyAnLCAnJylcbiAgICAgICAgICAgIGxldCBjaGlsZCA9IHRoaXMuY2FjaGUuaGFzKGNoaWxkTmFtZSkgPyB0aGlzLmNhY2hlLmdldChjaGlsZE5hbWUpIDogdGhpcy5jcmVhdGVOb2RlKGNoaWxkTmFtZSwgcGFyZW50KVxuICAgICAgICAgICAgaWYgKGNoaWxkICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGUuc2V0KGNoaWxkTmFtZSwgY2hpbGQpXG4gICAgICAgICAgICAgICAgcGFyZW50Py5jaGlsZHJlbi5wdXNoKGNoaWxkKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29tcHV0ZSgpOiBzdHJpbmcge1xuICAgICAgICBmb3IgKGxldCBrZXkgb2YgdGhpcy5jYWNoZS5rZXlzKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzLmNhY2hlLmdldChrZXkpXG4gICAgICAgICAgICBpZihub2RlICE9PSB1bmRlZmluZWQpe1xuICAgICAgICAgICAgICAgIHRoaXMuaGVscGVyKG5vZGUpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3JkZXIgPSAnJztcbiAgICAgICAgZm9yIChsZXQga2V5IG9mIHRoaXMuc2NoZWR1bGVkLmtleXMoKSkge1xuICAgICAgICAgICAgb3JkZXIgKz0ga2V5ICsgJyAnXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb3JkZXJcbiAgICB9XG5cbiAgICBjb3JyZWN0Rm9ybWF0KHN0cjogc3RyaW5nKTogQm9vbGVhbiB7XG4gICAgICAgIGlmIChzdHIuaW5jbHVkZXMoJzonKSkge1xuICAgICAgICAgICAgbGV0IHNwbGl0ID0gc3RyLnNwbGl0KCc6JylcbiAgICAgICAgICAgIGlmIChSZWdFeHAoL15cXHB7TH0vLCAndScpLnRlc3Qoc3BsaXRbMF0pKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgaXNFbXB0eSgpOiBCb29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmNhY2hlLnNpemUgPT09IDApXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVOb2RlKG5hbWU6IHN0cmluZywgcGFyZW50OiBOb2RlIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkLCBjaGlsZHJlbjogTm9kZVtdID0gbmV3IEFycmF5PE5vZGU+KCkpOiBOb2RlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICBwYXJlbnQ6IHBhcmVudCxcbiAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoZWxwZXIobm9kZTogTm9kZSkge1xuICAgICAgICBpZih0aGlzLnNjaGVkdWxlZC5oYXMobm9kZS5uYW1lKSkge3JldHVybn1cbiAgICAgICAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBmb3IgKGxldCBjaGlsZCBvZiBub2RlLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oZWxwZXIoY2hpbGQpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLnNjaGVkdWxlZC5oYXMobm9kZS5uYW1lKSkge1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWQuc2V0KG5vZGUubmFtZSwgdHJ1ZSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gbWFpbigpIHtcblxuICAgIGNvbnN0IHJsID0gY3JlYXRlSW50ZXJmYWNlKHtcbiAgICAgICAgaW5wdXQ6IHByb2Nlc3Muc3RkaW4sXG4gICAgICAgIC8vb3V0cHV0OiBwcm9jZXNzLnN0ZG91dFxuICAgIH0pO1xuXG4gICAgbGV0IHRyZWUgPSBuZXcgVHJlZSgpXG4gICAgZm9yIGF3YWl0IChjb25zdCBsaW5lIG9mIHJsKSB7XG4gICAgICAgIGlmIChsaW5lLnRyaW0oKVswXSA9PT0gJyMnIHx8IGxpbmUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBpZiAoIXRyZWUuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codHJlZS5jb21wdXRlKCkpXG4gICAgICAgICAgICAgICAgdHJlZSA9IG5ldyBUcmVlKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0cmVlLmNvcnJlY3RGb3JtYXQobGluZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTGluZSBpcyBpbmNvcnJlY3QgZm9ybWF0OiAke2xpbmV9YClcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YXNrID0gbGluZS50cmltKCkuc3BsaXQoJzonKVxuICAgICAgICB0cmVlLmFkZFRhc2sodGFza1swXSwgdGFza1sxXS5sZW5ndGggPiAwID8gdGFza1sxXS5zcGxpdCgnLCcpIDogbmV3IEFycmF5PHN0cmluZz4oKSlcbiAgICB9XG4gICAgY29uc29sZS5sb2codHJlZS5jb21wdXRlKCkpXG5cbn1cblxubWFpbigpLnRoZW4oKCkgPT4gcHJvY2Vzcy5leGl0KDApKS5jYXRjaChlID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGUpXG4gICAgcHJvY2Vzcy5leGl0KDEpXG59KSJdfQ==